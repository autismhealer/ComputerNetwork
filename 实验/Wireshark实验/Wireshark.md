# Wireshark实验

## 准备
请自行寻找或使用如下参考资料，了解`Wireshark`的基本使用：

1. 选择对哪块网卡进行数据包捕获
2. 开始/停止捕获
3. 了解 `Wireshark` 主要窗口区域
4. 设置数据包的过滤
5. 跟踪数据流

## 数据链路层

#### 实作一 熟悉 Ethernet 帧结构
抓包操作：

![](./picture/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/%E5%AE%9E%E4%BD%9C%E4%B8%80.jpg)

Ethernet帧结构：
7B前导码+1B帧前定界符+6B目的地址+6B源地址+2B类型字段+46~1500B数据字段+4B校验码

由图中可以看到帧的目的MAC为`44:f9:71:80:24:f2`,源MAC为`34:cf:f6:5c:1e:da`,类型为IPv4

##### 问题
> 你会发现 Wireshark 展现给我们的帧中没有校验字段，请了解一下原因。

回答：因为校验一般情况下会交给网卡来计算，之后wireshark才可以抓到包，因此wireshark中的校验码是默认过滤掉的。

#### 实作二 了解子网内/外通信时的 MAC 地址
> 1. `ping` 你旁边的计算机（同一子网），同时用 Wireshark 抓这些包（可使用 icmp 关键字进行过滤以利于分析），记录一下发出帧的目的 MAC 地址以及返回帧的源 MAC 地址是多少？这个 MAC 地址是谁的？
> 2. 然后 `ping qige.io` （或者本子网外的主机都可以），同时用 Wireshark 抓这些包（可 icmp 过滤），记录一下发出帧的目的 MAC 地址以及返回帧的源 MAC 地址是多少？这个 MAC 地址是谁的？
> 3. 再次 `ping www.cqjtu.edu.cn` （或者本子网外的主机都可以），同时用 Wireshark 抓这些包（可 icmp 过滤），记录一下发出帧的目的 MAC 地址以及返回帧的源 MAC 地址又是多少？这个 MAC 地址又是谁的？

1. 抓旁边计算机的包：

![](./picture/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/%E5%AE%9E%E4%BD%9C%E4%BA%8Cping.jpg)

![](./picture/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/%E5%AE%9E%E4%BD%9C%E4%BA%8C.jpg)

可以看到源MAC地址为`4c:02:20:69:1b:37`，目标MAC地址则为`34:cf:f6:5c:1e:da`，因此可以直到发出帧的目的MAC地址以及返回帧的源MAC地址都为对方计算机的MAC地址

2. 抓`ping qige.io`的包

![](./picture/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/%E5%AE%9E%E4%BD%9C%E4%BA%8C-pingqige.jpg)

![](./picture/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/%E5%AE%9E%E4%BD%9C%E4%BA%8C%E6%8A%93%E5%8C%85qige.jpg)

可以看到发出帧的目的MAC地址以及返回帧的源MAC地址都为`44:f9:71:80:24:f2`，与本机的MAC地址不一致，得知这是本机的默认网关的MAC地址。

3. 抓`www.cqjtu.edu.cn`的包

![](./picture/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/ping-cqjtu.jpg)

![](./picture/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/%E5%AE%9E%E4%BD%9C%E4%BA%8C%E6%8A%93%E5%8C%85cqjtu.jpg)

易得发出帧的目的 MAC 地址以及返回帧的源 MAC 地址都为`44:f9:71:80:24:f2`，仍然是本机默认网关的地址。

##### 问题
> 通过以上的实验，你会发现：
> 1. 访问本子网的计算机时，目的 MAC 就是该主机的
> 2. 访问非本子网的计算机时，目的 MAC 是网关的
> 请问原因是什么？

回答：因为当访问本子网的计算机时，不需要经过任何其他节点就可以访问到，因此目的MAC地址直接指向该计算机。
而当访问非本子网的计算机时就需要通过先通过网关，因此帧的下一个目的就是网关，因此目的MAC地址是网关的目的地址。

#### 实作三 掌握 ARP 解析过程


## 网络层

#### 实作一